<div
id="canvas"
class="canvas"
(click)="onCanvasClick($event)"
[ngClass]="{
  grab: canvasMoveMode && ! canvasMoving,
  grabbing: canvasMoveMode && canvasMoving,
  insert: selectedTool === Tools.Insert && ! canvasMoveMode
}"
[ngStyle]="{
  top: canvasTop + 'px',
  left: canvasLeft + 'px',
  width: 'calc(100% + ' + canvasWidthAddition + 'px)',
  height: 'calc(100% + ' + canvasHeightAddition + 'px)'
}">
  <app-pipeline
  *ngFor="let pipeline of data; let index = index"
  [pipelineData]="pipeline"
  (click)="onPipelineClick(index)"
  [ngClass]="{
    grab: canvasMoveMode && ! canvasMoving,
    grabbing: canvasMoveMode && canvasMoving,
    insert: selectedTool === Tools.Insert && ! canvasMoveMode,
    'insert-mode': selectedTool === Tools.Insert && ! canvasMoveMode && ! moduleHovered,
    'erase-mode': selectedTool === Tools.Erase && ! canvasMoveMode && ! moduleHovered
  }"
  [ngStyle]="{
    left: pipeline.position.left + 'px',
    top: pipeline.position.top + 'px'
  }"
  [appMovable]="! canvasMoveMode && selectedTool === Tools.Move"
  (onmovementstart)="onElementMovementStart()"
  (onmovementend)="onElementMovementEnd($event, index)">
    <app-module
    *ngFor="let module of pipeline.modules; let mindex = index"
    [moduleData]="module"
    [ngClass]="{
      'insert-mode': selectedTool === Tools.Insert && ! canvasMoveMode && moduleHovered,
      'erase-mode': selectedTool === Tools.Erase && ! canvasMoveMode && moduleHovered && ! moduleFieldHovered
    }"
    (mousemove)="onModuleMouseHover()"
    (mouseleave)="onModuleMouseLeave()"
    (click)="onModuleClick($event, index, mindex)">
      <app-module-field
      *ngFor="let field of module.fields"
      [moduleFieldData]="field"
      (mousemove)="onModuleFieldMouseHover()"
      (mouseleave)="onModuleFieldMouseLeave()"
      [ngClass]="{
        'erase-mode': selectedTool === Tools.Erase && ! canvasMoveMode && moduleFieldHovered
      }">
      </app-module-field>
    </app-module>
  </app-pipeline>
</div>
